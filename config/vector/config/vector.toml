#                                    __   __  __
#                                    \ \ / / / /
#                                     \ V / / /
#                                      \_/  \/
#
#                                    V E C T O R
#                                   Configuration
#
# ------------------------------------------------------------------------------
# Website: https://vector.dev
# Docs: https://vector.dev/docs
# Chat: https://chat.vector.dev
# ------------------------------------------------------------------------------

# Change this to use a non-default directory for Vector data storage:
# data_dir = "/var/lib/vector"

[sources.container-logs]
type = "docker_logs"
# NOTE: Unfortunately, "include_labels" is all or nothing, so we cannot use it here to filter on "container_type"; instead, we must apply a filter condition in remap-container-logs
# docker_host = "tcp://172.16.239.1:2376" # Necessary when running with Hyper-V containers on Windows, where the named pipe does not seem to work

[transforms.remap-container-logs]
type = "remap"
inputs = ["container-logs"]
file = "./config/remap-container-logs.vrl"

[transforms.filter-container-logs-on-container-type]
type = "filter"
inputs = ["remap-container-logs"]
condition = 'exists(.container_type)'

[transforms.filter-container-logs-on-level]
type = "filter"
inputs = ["filter-container-logs-on-container-type"]
condition = '.level == "warn" || .level == "error" || .level == "critical"'

[sinks.disk]
type = "file"
inputs = ["filter-container-logs-on-container-type"]
encoding.codec = "json"
compression = "none" # compression options: ["none", "gzip", "zstd"].
path = "C:\\cc-logs\\{{container_name}}-%Y-%m-%d_%H.log" # Remember to change file extension if enabling compression (e.g. ".gzip" or ".zst")

[sinks.rabbitmq]
type = "amqp"
inputs = ["filter-container-logs-on-level"]
connection_string = "amqp://rabbitmq-local:5672"
encoding.codec = "json"
exchange = ""

# Vector's GraphQL API (disabled by default)
# Use a browser or `vector top` to view detailed information at http://localhost:8686
# [api]
# enabled = true
# address = "127.0.0.1:8686"
